<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Administrador del Marcador</title>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database-compat.js"></script>
  <script src="firebase.js"></script>

  <style>
    body {
      background:#000;
      color:white;
      font-family:Arial, sans-serif;
      margin:0;
      padding:16px;
    }
    h1 {
      margin-top:0;
      margin-bottom:12px;
    }
    button, select, input {
      padding:8px;
      margin:4px;
      font-size:15px;
    }
    .section {
      background:#111;
      border:1px solid #444;
      border-radius:10px;
      margin-bottom:12px;
      padding:6px 10px;
    }
    .section summary {
      font-weight:bold;
      cursor:pointer;
      outline:none;
      list-style:none;
    }
    .section summary::-webkit-details-marker {
      display:none;
    }
    .section summary::before {
      content:"▶ ";
      font-size:11px;
    }
    .section[open] summary::before {
      content:"▼ ";
    }
    .field-row {
      margin:4px 0;
    }
    .field-row label {
      display:inline-block;
      width:110px;
      font-size:14px;
    }
    hr {
      border-color:#333;
    }
  </style>
</head>

<body>

<h1>Panel Administrador (OVT)</h1>

<!-- ==================== EQUIPOS ==================== -->
<details class="section" open>
  <summary>Equipos</summary>
  <div class="field-row">
    <label>Nombre:</label>
    <input id="new_team_name" style="width:200px;">
  </div>
  <div class="field-row">
    <label>Color:</label>
    <input id="new_team_color" type="color" value="#6ec9ff">
  </div>
  <button onclick="addTeam()">Guardar Equipo</button>
</details>

<!-- ==================== PARTIDO ==================== -->
<details class="section" open>
  <summary>Configurar Partido</summary>

  <div class="field-row">
    <label>Equipo Local:</label>
    <select id="team_home_select" style="width:220px;"></select>
  </div>

  <div class="field-row">
    <label>Equipo Visitante:</label>
    <select id="team_away_select" style="width:220px;"></select>
  </div>

  <div class="field-row">
    <label>Fecha:</label>
    <input id="date" style="width:220px;" placeholder="13/12/2025">
  </div>

  <div class="field-row">
    <label>Lugar:</label>
    <input id="location" style="width:220px;" placeholder="Deportiva Gomez Palacio">
  </div>

  <div class="field-row">
    <label>Cuarto:</label>
    <select id="quarter">
      <option>1Q</option>
      <option>2Q</option>
      <option>3Q</option>
      <option>4Q</option>
      <option>OT</option>
      <option>MT</option> <!-- medio tiempo -->
    </select>
    <span style="font-size:12px;opacity:0.8;">MT = Medio tiempo</span>
  </div>
</details>

<!-- ==================== POSESIÓN Y ANOTACIONES ==================== -->
<details class="section" open>
  <summary>Posesión y Anotaciones</summary>

  <h3>Posesión</h3>
  <button onclick="setPossession('home')">Posesión Local</button>
  <button onclick="setPossession('away')">Posesión Visitante</button>

  <hr>

  <h3>Anotaciones</h3>

<div style="border:1px solid #2b6cb0; border-radius:10px; padding:10px; margin-bottom:12px;">
  <h4 style="margin:0 0 8px 0;">Local</h4>
  <button onclick="addPoints('home',6,'TD_TIERA')">TD Tierra +6</button>
  <button onclick="addPoints('home',6,'TD_AIRE')">TD Aire +6</button>
  <button onclick="addPoints('home',1,'XP')">XP +1</button>
  <button onclick="addPoints('home',2,'2PT_TIERA')">Conv 2 pts (tierra)</button>
  <button onclick="addPoints('home',2,'2PT_AIRE')">Conv 2 pts (aire)</button>
  <button onclick="addPoints('home',3,'FG')">FG +3</button>
  <button onclick="addPoints('home',2,'SAFETY')">Safety +2</button>
</div>

<div style="border:1px solid #2b6cb0; border-radius:10px; padding:10px;">
  <h4 style="margin:0 0 8px 0;">Visitante</h4>
  <button onclick="addPoints('away',6,'TD_TIERA')">TD Tierra +6</button>
  <button onclick="addPoints('away',6,'TD_AIRE')">TD Aire +6</button>
  <button onclick="addPoints('away',1,'XP')">XP +1</button>
  <button onclick="addPoints('away',2,'2PT_TIERA')">Conv 2 pts (tierra)</button>
  <button onclick="addPoints('away',2,'2PT_AIRE')">Conv 2 pts (aire)</button>
  <button onclick="addPoints('away',3,'FG')">FG +3</button>
  <button onclick="addPoints('away',2,'SAFETY')">Safety +2</button>
</div>


<!-- ==================== CONTROL DEL PARTIDO ==================== -->
<details class="section" open>
  <summary>Control del Partido / Encuesta</summary>

  <h3>Control del partido</h3>
  <button style="background:red;color:white;" onclick="finishGame()">Finalizar y guardar en historial</button>
  <button style="background:#555;color:white;" onclick="resetGame()">Reset sin guardar</button>

  <hr>

  <h3>Encuesta ¿Quién ganará?</h3>
  <button onclick="setPollEnabled(true)">Activar encuesta</button>
  <button onclick="setPollEnabled(false)">Desactivar encuesta</button>
  <p id="poll_summary" style="font-size:13px;opacity:0.85;margin-top:6px;">
    Encuesta: sin datos todavía.
  </p>
</details>

<!-- ==================== ESTADÍSTICAS QB EN VIVO ==================== -->
<details class="section" open>
  <summary>Estadísticas QB (en vivo)</summary>

  <!-- Datos básicos del QB -->
  <div style="margin-bottom:10px;">
    Nombre:
    <input id="qb_name" style="width:180px;">
    Equipo:
    <input id="qb_team" style="width:160px;" value="Cyclones Navy">
    Posición:
    <input id="qb_position" style="width:60px;" value="QB">
    <button onclick="saveQbInfo()">Guardar info QB</button>
  </div>

  <hr>

  <!-- Yardas por jugada -->
  <div style="margin-bottom:8px;">
    Yds de pase (jugada):
    <input id="qb_pass_yds_delta" type="number" style="width:80px;">
    <button onclick="addQbYards('pass')">Sumar</button>
  </div>

  <div style="margin-bottom:8px;">
    Yds por tierra (jugada):
    <input id="qb_rush_yds_delta" type="number" style="width:80px;">
    <button onclick="addQbYards('rush')">Sumar</button>
  </div>

  <!-- Eventos discretos -->
  <div style="margin-top:10px;">
    <button onclick="addQbStatDelta('pass_td',1)">TD pase +1</button>
    <button onclick="addQbStatDelta('rush_td',1)">TD carrera +1</button>
    <button onclick="addQbStatDelta('ints',1)">Intercepción +1</button>
  </div>

  <p style="font-size:13px;opacity:0.8;margin-top:8px;">
    En cada jugada escribe solo las yardas de esa acción y presiona <b>Sumar</b>.
    El sistema acumula todo automáticamente.
  </p>
</details>

<script>
  // ================== REFERENCIAS FIREBASE ==================
  const refTeams   = db.ref("teams");
  const refGame    = db.ref("game");
  const refHistory = db.ref("history");
  const refQb      = refGame.child("players").child("qb");

  // ================== EQUIPOS ==================
  function addTeam() {
    const name  = document.getElementById("new_team_name").value.trim();
    const color = document.getElementById("new_team_color").value;

    if (!name) {
      alert("Escribe un nombre de equipo.");
      return;
    }

    refTeams.child(name).set({ color })
      .then(() => {
        alert("Equipo guardado.");
        document.getElementById("new_team_name").value = "";
      })
      .catch(err => {
        console.error(err);
        alert("Error al guardar equipo.");
      });
  }

  // Llenar selects con equipos
  refTeams.on("value", snap => {
    const teams = snap.val() || {};
    const homeSel = document.getElementById("team_home_select");
    const awaySel = document.getElementById("team_away_select");
    homeSel.innerHTML = "";
    awaySel.innerHTML = "";
    for (const t in teams) {
      homeSel.innerHTML += `<option>${t}</option>`;
      awaySel.innerHTML += `<option>${t}</option>`;
    }
  });

  // ================== CONFIG PARTIDO (sync en vivo) ==================
  let lastQuarter = null;

  setInterval(() => {
    const qSel  = document.getElementById("quarter").value || "1Q";
    const home  = document.getElementById("team_home_select").value || "";
    const away  = document.getElementById("team_away_select").value || "";
    const date  = document.getElementById("date").value || "";
    const place = document.getElementById("location").value || "";

    // Cambio de cuarto → mensaje al timeline
    if (lastQuarter === null) {
      lastQuarter = qSel;
    } else if (qSel !== lastQuarter) {
      refGame.once("value").then(snap => {
        const data = snap.val() || {};
        const tl   = data.timeline || [];

        let msg = "";
        if (qSel === "MT") {
          msg = `Termina el ${lastQuarter}. Entramos a medio tiempo.`;
        } else if (lastQuarter === "MT") {
          msg = `Termina el medio tiempo, comienza el ${qSel}.`;
        } else {
          msg = `Se termina el ${lastQuarter}. Comienza el ${qSel}.`;
        }

        const nuevoTL = [...tl, msg];

        refGame.update({
          team_home: home,
          team_away: away,
          date:      date,
          location:  place,
          quarter:   qSel,
          timeline:  nuevoTL
        });

        lastQuarter = qSel;
      });
      return;
    }

    // Actualización normal
    refGame.update({
      team_home: home,
      team_away: away,
      date:      date,
      location:  place,
      quarter:   qSel
    });
  }, 1500);

  // ================== POSESIÓN ==================
  function setPossession(team) {
    refGame.update({ possession: team });
  }

  // ================== NARRATIVA ANOTACIONES ==================
  const FRASES_TD = [
    "con una jugada explosiva que rompe la defensa.",
    "tras una serie ofensiva perfecta que culmina en las diagonales.",
    "con un acarreo poderoso que nadie pudo detener.",
    "gracias a un pase preciso que encuentra a su receptor en la zona de anotación.",
    "rematando una larga ofensiva que desgastó por completo a la defensa rival.",
    "aprovechando un error defensivo para convertir seis puntos vitales.",
    "con una jugada sorpresa que tomó desprevenida a la defensiva.",
    "mostrando poder ofensivo y autoridad en la zona roja.",
    "con una gran combinación por aire que termina en touchdown.",
    "tras mover las cadenas con calma y ejecutar a la perfección en zona roja.",
    "encendiendo al público con un touchdown espectacular.",
    "demostrando sangre fría en tercera oportunidad cerca de la zona de anotación.",
    "con una ofensiva rápida que recorrió el campo en pocos intentos.",
    "aprovechando cada yarda para llegar a la zona prometida.",
    "con un ataque terrestre contundente que abre el camino a seis puntos."
  ];

  const FRASES_FG = [
    "con un gol de campo seguro que suma tres puntos al marcador.",
    "aprovechando la oportunidad y eligiendo la vía segura de tres puntos.",
    "con una patada precisa que pasa justo entre los postes.",
    "que les permite acercarse en el marcador con un FG efectivo.",
    "añadiendo tres puntos que podrían ser clave más adelante.",
    "mostrando tranquilidad del pateador en un intento importante.",
    "con un gol de campo que mantiene viva la ofensiva.",
    "acortando la distancia con una patada bien ejecutada.",
    "castigando la defensa rival con tres puntos desde la larga distancia.",
    "tras quedarse cortos en zona roja pero capitalizando con un FG.",
    "asegurando puntos en una serie que parecía perderse.",
    "con una patada que mantiene la presión sobre el rival.",
    "sumando de a poco pero sin dejar de anotar.",
    "que mantiene el juego dentro de una posesión.",
    "con un gol de campo que silencia momentáneamente a la afición rival."
  ];

  const FRASES_XP = [
    "convirtiendo sin problemas el punto extra.",
    "asegurando el punto adicional para completar la serie.",
    "sumando un punto más que redondea la anotación.",
    "manteniendo la confianza en la unidad de gol de campo.",
    "con una patada sencilla pero importante para el marcador.",
    "completando los siete puntos tras el touchdown.",
    "demostrando solidez en la ejecución del punto extra.",
    "sin margen de error en el intento de XP.",
    "sumando un punto que podría marcar diferencia al final.",
    "cerrando la ofensiva con el adicional bueno.",
    "mostrando seguridad total del pateador.",
    "con un XP perfecto que no deja dudas.",
    "añadiendo un punto más a la cuenta.",
    "confirmando la ventaja obtenida con el touchdown.",
    "redondeando una gran serie ofensiva."
  ];

  const FRASES_SAFETY = [
    "gracias a una defensa implacable que encierra al rival en su propia zona.",
    "aprovechando la presión defensiva para forzar el error en la zona de anotación.",
    "con una jugada defensiva enorme que termina en safety.",
    "demostrando un front defensivo dominante que no da respiro.",
    "forzando al mariscal rival a cometer un error costoso en su propia zona.",
    "haciendo sentir el peso de la defensiva y sumando dos puntos importantes.",
    "castigando a la ofensiva rival con una jugada espectacular detrás de la línea.",
    "con un safety que cambia la inercia del partido.",
    "demostrando que la defensa también puede poner puntos en el marcador.",
    "aprovechando una mala protección para encerrar al corredor.",
    "haciendo retroceder tanto a la ofensiva rival que terminan dentro de su propia zona.",
    "con una lectura perfecta de la jugada ofensiva para conseguir el safety.",
    "sumando dos puntos defensivos que levantan al equipo.",
    "dejando claro que no hay espacio para errores cerca de la propia zona.",
    "con una jugada defensiva que prende fuego a la banca y a la afición."
  ];

  const FRASES_2PT = [
    "arriesgando con una conversión de dos puntos que sale perfecta.",
    "demostrando agresividad ofensiva al ir por dos y conseguirlo.",
    "aprovechando el momento para sumar dos puntos extra fundamentales.",
    "rompiendo el guion con una jugada de dos puntos muy bien ejecutada.",
    "mandando un mensaje claro: este equipo viene a ganar, no a conformarse con uno.",
    "con una conversión de dos puntos que mantiene la presión sobre la defensa rival.",
    "decidiendo no ir por el punto extra tradicional y cobrando dos completos.",
    "con una jugada diseñada específicamente para la conversión, ejecutada a la perfección.",
    "mostrando confianza total en la ofensiva al buscar y conseguir dos puntos más.",
    "sumando dos puntos que pueden marcar la diferencia en un cierre apretado."
  ];

  function extraContexto({ esOT, esRemontada, esCerrado, esPaliza }) {
    if (esOT)       return " En un tiempo extra lleno de tensión, cada jugada cuenta al máximo.";
    if (esRemontada)return " Esta jugada completa una gran remontada que cambia la historia del partido.";
    if (esCerrado)  return " El marcador sigue muy cerrado y cada punto pesa muchísimo.";
    if (esPaliza)   return " La ventaja sigue creciendo y el dominio es cada vez más claro.";
    return "";
  }

  function narrarJugada(data, teamSide, pts, tipoCorto) {
    const quarter      = data.quarter || "";
    const nombreEquipo = teamSide === "home" ? data.team_home : data.team_away;

    const oldHome = data.score_home || 0;
    const oldAway = data.score_away || 0;

    const newHome = teamSide === "home" ? oldHome + pts : oldHome;
    const newAway = teamSide === "away" ? oldAway + pts : oldAway;

    const accionBase = `${quarter} • ${tipoCorto} de ${nombreEquipo} (${pts} pts)`;

    const diffNueva = Math.abs(newHome - newAway);

    const ibaPerdiendo =
      (teamSide === "home" && oldHome < oldAway) ||
      (teamSide === "away" && oldAway < oldHome);

    const ahoraVaGanando =
      (teamSide === "home" && newHome > newAway) ||
      (teamSide === "away" && newAway > newHome);

    const esRemontada = ibaPerdiendo && ahoraVaGanando;
    const esCerrado   = diffNueva <= 3;
    const esPaliza    = diffNueva >= 20;
    const esOT        = quarter === "OT";

    let pool = [];
    if (tipoCorto === "TD")       pool = FRASES_TD;
    else if (tipoCorto === "FG")  pool = FRASES_FG;
    else if (tipoCorto === "XP")  pool = FRASES_XP;
    else if (tipoCorto === "2PT") pool = FRASES_2PT;
    else if (tipoCorto === "Safety") pool = FRASES_SAFETY;

    const frase = pool[Math.floor(Math.random() * pool.length)] || "";
    const extra = extraContexto({ esOT, esRemontada, esCerrado, esPaliza });

    return `${accionBase} ${frase}${extra}`.trim();
  }

 function addPoints(teamSide, pts, tipoKey) {
  refGame.once("value").then(snap => {
    const data = snap.val() || {};

    const oldHome = data.score_home || 0;
    const oldAway = data.score_away || 0;

    const quarter = data.quarter || "1Q";
    const nombreEquipo = teamSide === "home" ? (data.team_home || "Local") : (data.team_away || "Visitante");

    // Texto corto y tipo para elegir frases
    let tipoCorto = "";
    let etiqueta = "";

    if (tipoKey === "TD_TIERA") { tipoCorto = "TD"; etiqueta = "TD Tierra"; }
    if (tipoKey === "TD_AIRE")  { tipoCorto = "TD"; etiqueta = "TD Aire"; }
    if (tipoKey === "FG")       { tipoCorto = "FG"; etiqueta = "FG"; }
    if (tipoKey === "XP")       { tipoCorto = "XP"; etiqueta = "XP"; }
    if (tipoKey === "SAFETY")   { tipoCorto = "Safety"; etiqueta = "Safety"; }
    if (tipoKey === "2PT_TIERA"){ tipoCorto = "2PT"; etiqueta = "Conv 2 pts (tierra)"; }
    if (tipoKey === "2PT_AIRE") { tipoCorto = "2PT"; etiqueta = "Conv 2 pts (aire)"; }

    // Armar narrativa épica pero sin mentir (tierra/aire)
    // Usamos tu narrarJugada() pero con un "tipoCorto" compatible
    // y además ponemos la etiqueta clara en el texto base.
    const fraseBase = `${quarter} • ${etiqueta} de ${nombreEquipo} (${pts} pts)`;

    // Reutilizamos tu lógica de contexto comparando marcador anterior/nuevo
    const newHome = teamSide === "home" ? oldHome + pts : oldHome;
    const newAway = teamSide === "away" ? oldAway + pts : oldAway;

    const diffNueva = Math.abs(newHome - newAway);
    const ibaPerdiendo =
      (teamSide === "home" && oldHome < oldAway) ||
      (teamSide === "away" && oldAway < oldHome);

    const ahoraVaGanando =
      (teamSide === "home" && newHome > newAway) ||
      (teamSide === "away" && newAway > newHome);

    const esRemontada = ibaPerdiendo && ahoraVaGanando;
    const esCerrado   = diffNueva <= 3;
    const esPaliza    = diffNueva >= 20;
    const esOT        = quarter === "OT";

    // Elegir pool de frases
    let pool = [];
    if (tipoCorto === "TD") pool = FRASES_TD;
    else if (tipoCorto === "FG") pool = FRASES_FG;
    else if (tipoCorto === "XP") pool = FRASES_XP;
    else if (tipoCorto === "2PT") pool = FRASES_2PT;
    else if (tipoCorto === "Safety") pool = FRASES_SAFETY;

    const frase = pool[Math.floor(Math.random() * pool.length)] || "";
    const extra = extraContexto({ esOT, esRemontada, esCerrado, esPaliza });

    const fraseCompleta = `${fraseBase} ${frase}${extra}`.trim();

    // Timeline (al final)
    const timelineActual = data.timeline || [];
    const nuevoTimeline  = [...timelineActual, fraseCompleta];

    // Actualizar marcador
    const finalHome = newHome;
    const finalAway = newAway;

    return refGame.update({
      score_home: finalHome,
      score_away: finalAway,
      timeline: nuevoTimeline
    });
  }).catch(err => {
    console.error(err);
    alert("Error al registrar la anotación.");
  });
}

  // ================== FINALIZAR / RESET ==================
  function resetGameInternal(msg) {
    lastQuarter = null;
    refGame.set({
      team_home: "",
      team_away: "",
      date: "",
      location: "",
      quarter: "1Q",
      score_home: 0,
      score_away: 0,
      possession: null,
      timeline: [],
      pollEnabled: false,
      pollVotes: null,
      players: {}
    }).then(() => {
      document.getElementById("team_home_select").value = "";
      document.getElementById("team_away_select").value = "";
      document.getElementById("date").value = "";
      document.getElementById("location").value = "";
      document.getElementById("quarter").value = "1Q";
      if (msg) alert(msg);
    });
  }

  function resetGame() {
    if (!confirm("¿Seguro que quieres resetear el marcador sin guardar en historial?")) return;
    resetGameInternal("Marcador reseteado.");
  }

  function finishGame() {
    if (!confirm("¿Finalizar partido y guardar en historial?")) return;

    refGame.once("value").then(snap => {
      const data = snap.val() || {};

      const homeName = data.team_home || "Local";
      const awayName = data.team_away || "Visitante";
      const home     = data.score_home || 0;
      const away     = data.score_away || 0;

      const tl = data.timeline || [];
      const finalMsg = `FINAL • El partido termina con marcador ${homeName} ${home} - ${away} ${awayName}.`;

      const timestamp = Date.now();
      const historyRef = refHistory.child(timestamp.toString());

      const historyData = {
        ...data,
        finished: true,
        timeline: [...tl, finalMsg],
        finishedAt: timestamp
      };

      return historyRef.set(historyData);
    }).then(() => {
      resetGameInternal("Partido finalizado, guardado en historial y marcador reiniciado.");
    }).catch(err => {
      console.error(err);
      alert("Ocurrió un error al finalizar el partido.");
    });
  }

  // ================== ENCUESTA ==================
  function setPollEnabled(flag) {
    refGame.update({ pollEnabled: !!flag });
  }

  // Mostrar resumen de votos en el admin
  refGame.on("value", snap => {
    const data = snap.val() || {};
    const votes = data.pollVotes || {};
    let home = 0, away = 0;
    for (const id in votes) {
      const v = votes[id];
      if (v.team === "home") home++;
      else if (v.team === "away") away++;
    }
    const total = home + away;
    const p = document.getElementById("poll_summary");
    if (!total) {
      p.innerText = "Encuesta: sin votos todavía.";
    } else {
      p.innerText = `Encuesta: Local ${home} votos • Visitante ${away} votos • Total ${total}`;
    }
  });

  // ================== QB STATS EN VIVO ==================
  function saveQbInfo() {
    const name = document.getElementById("qb_name").value.trim();
    const team = document.getElementById("qb_team").value.trim();
    const position = document.getElementById("qb_position").value.trim() || "QB";

    if (!name || !team) {
      alert("Ingresa al menos nombre y equipo del QB.");
      return;
    }

    refQb.once("value").then(snap => {
      const data = snap.val() || {};
      const stats = data.stats || {
        pass_yds: 0,
        pass_td: 0,
        rush_yds: 0,
        rush_td: 0,
        ints: 0
      };

      return refQb.set({
        name,
        team,
        position,
        stats
      });
    }).then(() => {
      alert("Información del QB guardada.");
    }).catch(err => {
      console.error(err);
      alert("Error al guardar info del QB.");
    });
  }

  function addQbYards(tipo) {
    const inputId = (tipo === "pass") ? "qb_pass_yds_delta" : "qb_rush_yds_delta";
    const field   = (tipo === "pass") ? "pass_yds"       : "rush_yds";

    const input = document.getElementById(inputId);
    const val = parseInt(input.value, 10);

    if (isNaN(val)) {
      alert("Ingresa un número de yardas para la jugada.");
      return;
    }

    refQb.once("value").then(snap => {
      const data  = snap.val() || {};
      const stats = data.stats || {
        pass_yds: 0,
        pass_td: 0,
        rush_yds: 0,
        rush_td: 0,
        ints: 0
      };

      const prev = stats[field] || 0;
      stats[field] = prev + val;

      return refQb.update({ stats });
    }).then(() => {
      input.value = "";
    }).catch(err => {
      console.error(err);
      alert("Error al actualizar yardas del QB.");
    });
  }

  function addQbStatDelta(field, delta) {
    delta = delta || 1;

    refQb.once("value").then(snap => {
      const data  = snap.val() || {};
      const stats = data.stats || {
        pass_yds: 0,
        pass_td: 0,
        rush_yds: 0,
        rush_td: 0,
        ints: 0
      };

      const prev = stats[field] || 0;
      stats[field] = prev + delta;

      return refQb.update({ stats });
    }).catch(err => {
      console.error(err);
      alert("Error al actualizar estadísticas del QB.");
    });
  }
</script>
<div class="box">
  <h2>Historial</h2>

  <select id="history_select" style="width:100%;max-width:520px;"></select>
  <button onclick="loadFromHistory()">Cargar al marcador</button>
</div>

</body>
</html>
