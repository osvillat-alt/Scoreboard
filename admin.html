<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Administrador del Marcador</title>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database-compat.js"></script>
  <script src="firebase.js"></script>

  <style>
    body { background:#111; color:white; font-family:Arial, sans-serif; padding:20px; }
    button, select, input { padding:8px 10px; margin:4px; font-size:14px; }
    h1 { margin-top:0; }

    .box {
      border:1px solid #333;
      border-radius:10px;
      margin:12px 0;
      background:#181818;
      overflow:hidden;
    }
    .box-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:10px 14px;
      background:#222;
      cursor:pointer;
    }
    .box-header h2 {
      margin:0;
      font-size:17px;
    }
    .box-header span.toggle-icon {
      font-size:16px;
      transition:transform 0.2s ease;
    }
    .box-content {
      padding:12px 14px 14px;
    }
    .box.collapsed .box-content {
      display:none;
    }
    .box.collapsed .toggle-icon {
      transform:rotate(-90deg);
    }

    .field-group {
      margin-bottom:6px;
      font-size:14px;
    }
    .field-group label {
      display:inline-block;
      min-width:80px;
      font-size:13px;
      opacity:0.9;
    }
    .field-group input, .field-group select {
      min-width:160px;
    }

    .anot-grid {
      display:flex;
      flex-wrap:wrap;
      gap:10px;
    }
    .anot-col {
      flex:1 1 220px;
      padding:10px;
      border-radius:8px;
      background:#202020;
    }
    .anot-col h3 {
      margin-top:0;
      font-size:15px;
      margin-bottom:6px;
    }
    .anot-col.home { border:1px solid #6ec9ff; }
    .anot-col.away { border:1px solid #94b3ff; }

    .qb-grid {
      display:flex;
      flex-wrap:wrap;
      gap:10px;
    }
    .qb-card {
      flex:1 1 230px;
      background:#202020;
      border-radius:8px;
      padding:10px;
    }
    .qb-card h3 {
      margin-top:0;
      font-size:15px;
      margin-bottom:8px;
    }
    .qb-stats-row {
      display:flex;
      flex-wrap:wrap;
      gap:4px 8px;
      font-size:13px;
      margin-bottom:3px;
    }
    .qb-stats-row label {
      min-width:120px;
    }
    .qb-card button {
      margin-top:6px;
    }

    /* Botones principales */
    .danger-btn {
      background:#b30000;
      color:white;
      border:none;
      border-radius:6px;
      padding:10px 12px;
      cursor:pointer;
    }
    .secondary-btn {
      background:#444;
      color:white;
      border:none;
      border-radius:6px;
      padding:10px 12px;
      cursor:pointer;
    }

    /* Logo pequeño en esquina */
    #ovt-corner-logo {
      position: fixed;
      bottom: 12px;
      right: 12px;
      opacity: 0.75;
      width: 80px;
      pointer-events: none;
      z-index: 9999;
    }

    @media (max-width:600px) {
      button, select, input { font-size:13px; }
    }
  </style>
</head>

<body>

<h1>Panel Administrador (OVT)</h1>

<!-- EQUIPOS -->
<div class="box">
  <div class="box-header" onclick="toggleBox(this)">
    <h2>Equipos</h2>
    <span class="toggle-icon">▼</span>
  </div>
  <div class="box-content">
    <div class="field-group">
      <label for="new_team_name">Nombre</label>
      <input id="new_team_name" />
    </div>
    <div class="field-group">
      <label for="new_team_color">Color</label>
      <input id="new_team_color" type="color" value="#ff0000" />
    </div>
    <button onclick="addTeam()">Guardar Equipo</button>
  </div>
</div>

<!-- CONFIG PARTIDO -->
<div class="box">
  <div class="box-header" onclick="toggleBox(this)">
    <h2>Configurar Partido</h2>
    <span class="toggle-icon">▼</span>
  </div>
  <div class="box-content">
    <div class="field-group">
      <label>Local</label>
      <select id="team_home_select"></select>
    </div>
    <div class="field-group">
      <label>Visitante</label>
      <select id="team_away_select"></select>
    </div>
    <div class="field-group">
      <label>Fecha</label>
      <input id="date" />
    </div>
    <div class="field-group">
      <label>Lugar</label>
      <input id="location" />
    </div>
    <div class="field-group">
      <label>Cuarto</label>
      <select id="quarter">
        <option>1Q</option>
        <option>2Q</option>
        <option>MT</option> <!-- Medio tiempo -->
        <option>3Q</option>
        <option>4Q</option>
        <option>OT</option>
      </select>
    </div>
    <p style="font-size:12px;opacity:0.8;">
      Secuencia permitida: 1Q → 2Q → MT → 3Q → 4Q → OT
    </p>
  </div>
</div>

<!-- POSESIÓN -->
<div class="box">
  <div class="box-header" onclick="toggleBox(this)">
    <h2>Posesión</h2>
    <span class="toggle-icon">▼</span>
  </div>
  <div class="box-content">
    <button onclick="setPossession('home')">Local</button>
    <button onclick="setPossession('away')">Visitante</button>
  </div>
</div>

<!-- ANOTACIONES -->
<div class="box">
  <div class="box-header" onclick="toggleBox(this)">
    <h2>Anotaciones</h2>
    <span class="toggle-icon">▼</span>
  </div>
  <div class="box-content">
    <div class="anot-grid">
      <div class="anot-col home">
        <h3>Local</h3>
        <button onclick="addPoints('home',6,'Touchdown','run')">TD Tierra +6</button>
        <button onclick="addPoints('home',6,'Touchdown','pass')">TD Aire +6</button><br>
        <button onclick="addPoints('home',1,'Extra Point')">XP +1</button>
        <button onclick="addPoints('home',2,'2pt Conversion','run')">Conv. 2 pts (tierra)</button>
        <button onclick="addPoints('home',2,'2pt Conversion','pass')">Conv. 2 pts (aire)</button><br>
        <button onclick="addPoints('home',3,'Field Goal')">FG +3</button>
        <button onclick="addPoints('home',2,'Safety')">Safety +2</button>
      </div>

      <div class="anot-col away">
        <h3>Visitante</h3>
        <button onclick="addPoints('away',6,'Touchdown','run')">TD Tierra +6</button>
        <button onclick="addPoints('away',6,'Touchdown','pass')">TD Aire +6</button><br>
        <button onclick="addPoints('away',1,'Extra Point')">XP +1</button>
        <button onclick="addPoints('away',2,'2pt Conversion','run')">Conv. 2 pts (tierra)</button>
        <button onclick="addPoints('away',2,'2pt Conversion','pass')">Conv. 2 pts (aire)</button><br>
        <button onclick="addPoints('away',3,'Field Goal')">FG +3</button>
        <button onclick="addPoints('away',2,'Safety')">Safety +2</button>
      </div>
    </div>
  </div>
</div>

<!-- ESTADÍSTICAS QB -->
<div class="box">
  <div class="box-header" onclick="toggleBox(this)">
    <h2>Estadísticas QB (partido actual)</h2>
    <span class="toggle-icon">▼</span>
  </div>
  <div class="box-content">
    <div class="qb-grid">
      <!-- QB LOCAL -->
      <div class="qb-card">
        <h3>QB Local</h3>
        <div class="field-group">
          <label>Nombre</label>
          <input id="qb_home_name" />
        </div>
        <div class="field-group">
          <label>Posición</label>
          <input id="qb_home_pos" value="QB" />
        </div>
        <div class="qb-stats-row">
          <label>Yds pase</label>
          <input id="qb_home_pass_yds" type="number" value="0" />
        </div>
        <div class="qb-stats-row">
          <label>TD pase</label>
          <input id="qb_home_pass_td" type="number" value="0" />
        </div>
        <div class="qb-stats-row">
          <label>Intercepciones</label>
          <input id="qb_home_int" type="number" value="0" />
        </div>
        <div class="qb-stats-row">
          <label>Yds tierra</label>
          <input id="qb_home_rush_yds" type="number" value="0" />
        </div>
        <div class="qb-stats-row">
          <label>TD tierra</label>
          <input id="qb_home_rush_td" type="number" value="0" />
        </div>
        <button onclick="saveQB('home')">Guardar QB Local</button>
      </div>

      <!-- QB VISITANTE -->
      <div class="qb-card">
        <h3>QB Visitante</h3>
        <div class="field-group">
          <label>Nombre</label>
          <input id="qb_away_name" />
        </div>
        <div class="field-group">
          <label>Posición</label>
          <input id="qb_away_pos" value="QB" />
        </div>
        <div class="qb-stats-row">
          <label>Yds pase</label>
          <input id="qb_away_pass_yds" type="number" value="0" />
        </div>
        <div class="qb-stats-row">
          <label>TD pase</label>
          <input id="qb_away_pass_td" type="number" value="0" />
        </div>
        <div class="qb-stats-row">
          <label>Intercepciones</label>
          <input id="qb_away_int" type="number" value="0" />
        </div>
        <div class="qb-stats-row">
          <label>Yds tierra</label>
          <input id="qb_away_rush_yds" type="number" value="0" />
        </div>
        <div class="qb-stats-row">
          <label>TD tierra</label>
          <input id="qb_away_rush_td" type="number" value="0" />
        </div>
        <button onclick="saveQB('away')">Guardar QB Visitante</button>
      </div>
    </div>
    <p style="font-size:12px;opacity:0.8;margin-top:6px;">
      Más adelante podemos agregar más posiciones y estadísticas usando esta misma estructura.
    </p>
  </div>
</div>

<!-- ENCUESTA -->
<div class="box">
  <div class="box-header" onclick="toggleBox(this)">
    <h2>Encuesta: ¿Quién ganará?</h2>
    <span class="toggle-icon">▼</span>
  </div>
  <div class="box-content">
    <button onclick="enablePoll(true)">Activar encuesta</button>
    <button onclick="enablePoll(false)">Ocultar encuesta</button>
    <div id="poll_summary" style="margin-top:10px; font-size:14px;"></div>
  </div>
</div>

<!-- FINAL / RESET -->
<div class="box">
  <div class="box-header" onclick="toggleBox(this)">
    <h2>Finalizar / Resetear</h2>
    <span class="toggle-icon">▼</span>
  </div>
  <div class="box-content">
    <button class="danger-btn" onclick="finishGame()">Finalizar Partido</button>
    <button class="secondary-btn" onclick="resetGame()">Reset sin guardar</button>
  </div>
</div>

<script>
  const refTeams = db.ref("teams");
  const refGame  = db.ref("game");

  const QUARTER_ORDER = ["1Q", "2Q", "MT", "3Q", "4Q", "OT"];

  function toggleBox(headerEl) {
    const box = headerEl.parentElement;
    box.classList.toggle("collapsed");
  }

  // ===== FRASES EPICAS =====
  const FRASES_TD = [
    "tras una serie ofensiva perfecta que culmina en la zona de anotación.",
    "rematando una ofensiva larga que desgastó por completo a la defensa rival.",
    "aprovechando al máximo la oportunidad en la zona roja.",
    "coronando un drive sostenido que avanzó yarda a yarda.",
    "con una ejecución impecable cerca de la línea de gol.",
    "terminando una ofensiva paciente y muy bien manejada.",
    "rompiendo el equilibrio del partido con seis puntos clave.",
    "mostrando temple en una serie crucial cerca de la anotación.",
    "aprovechando cada yarda hasta llegar a la zona prometida.",
    "cerrando una posesión importante con puntos en el marcador.",
    "imponiendo condiciones en el momento justo del encuentro.",
    "capitalizando un buen campo de posición para llegar a las diagonales.",
    "haciendo pagar caro a la defensa por dejar espacios en su esquema.",
    "sumando seis puntos que cambian el ritmo del partido."
  ];

  const FRASES_FG = [
    "con un gol de campo seguro que suma tres puntos al marcador.",
    "aprovechando la oportunidad y eligiendo la vía segura de tres puntos.",
    "con una patada precisa que pasa justo entre los postes.",
    "que les permite acercarse en el marcador con un FG efectivo.",
    "añadiendo tres puntos que podrían ser clave más adelante.",
    "mostrando tranquilidad del pateador en un intento importante.",
    "con un gol de campo que mantiene viva la ofensiva.",
    "acortando la distancia con una patada bien ejecutada.",
    "castigando la defensa rival con tres puntos desde la larga distancia.",
    "tras quedarse cortos en zona ro
