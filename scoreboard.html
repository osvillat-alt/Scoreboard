<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Marcador en Vivo</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@400;700&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database-compat.js"></script>
<script src="firebase.js"></script>

<style>
body{
margin:0;
background:#0b0c15;
color:white;
font-family:Orbitron;
padding:15px;
}

.wrap{max-width:1100px;margin:auto;}

.tabs{
display:flex;
justify-content:center;
margin-bottom:20px;
}

.tab{
background:#111;
border:1px solid #333;
color:#777;
padding:10px 25px;
cursor:pointer;
font-weight:bold;
margin:0 3px;
}

.tab.active{
color:#f39c12;
border-color:#f39c12;
}

.scoreboard{
background:#000;
border-radius:10px;
overflow:hidden;
box-shadow:0 0 25px black;
}

.scoreboard-inner{
display:grid;
grid-template-columns:1fr auto 1fr;
}

.team-panel{
display:flex;
align-items:center;
justify-content:space-between;
padding:20px;
position:relative;
}

.team-panel::before{
content:"";
position:absolute;
inset:0;
background:linear-gradient(90deg,var(--team-color,#222),transparent 80%);
opacity:.7;
}

.team-panel.away::before{
background:linear-gradient(-90deg,var(--team-color,#222),transparent 80%);
}

.team-logo{
width:80px;
height:80px;
border-radius:50%;
overflow:hidden;
z-index:2;
}

.team-logo img{width:100%;height:100%;object-fit:cover;}

.team-info{z-index:2}

.team-name{
font-family:Roboto;
font-size:20px;
font-weight:bold;
}

.team-score{
font-size:60px;
font-weight:900;
}

.center-block{
display:flex;
align-items:center;
justify-content:center;
width:70px;
background:#111;
font-weight:bold;
}

.bottom-bar{
display:flex;
justify-content:space-between;
padding:10px 20px;
background:#111;
}

.quarter-dot{
width:12px;
height:12px;
background:#222;
display:inline-block;
margin:2px;
}

.quarter-dot.active{
background:#f39c12;
box-shadow:0 0 6px #f39c12;
}

.quarter-dot.completed{
background:#555;
}

.timeline li{
border-left:3px solid #f39c12;
padding-left:10px;
margin:8px 0;
font-family:Roboto;
}

.content-box{
background:#111;
padding:15px;
margin-top:20px;
}

.watermark{
position:fixed;
bottom:15px;
right:15px;
width:60px;
opacity:.18;
pointer-events:none;
}

</style>
</head>

<body>

<img src="bb6b5054-8bfb-4159-b6c0-b19a23ba52b3.png" class="watermark"/>

<div class="wrap">

<div class="tabs">
<button id="tabScore" class="tab active" onclick="showTab('score')">Marcador</button>
<button id="tabStats" class="tab" onclick="showTab('stats')">Estadísticas</button>
<button id="tabHistory" class="tab" onclick="showTab('history')">Historial</button>
</div>

<!-- SCORE -->
<div id="viewScore">

<div id="metaLine" style="text-align:center;margin-bottom:15px;font-family:Roboto"></div>

<div class="scoreboard">
<div class="scoreboard-inner">

<div id="homePanel" class="team-panel home">
<div id="homeLogo" class="team-logo"></div>
<div class="team-info">
<div id="homeName" class="team-name">Local</div>
<div id="homeScore" class="team-score">0</div>
</div>
</div>

<div class="center-block">VS</div>

<div id="awayPanel" class="team-panel away">
<div id="awayLogo" class="team-logo"></div>
<div class="team-info">
<div id="awayName" class="team-name">Visitante</div>
<div id="awayScore" class="team-score">0</div>
</div>
</div>

</div>

<div class="bottom-bar">
<div>
CUARTO: <span id="quarterText">1Q</span>
<div id="quarterBadges">
<div class="quarter-dot"></div>
<div class="quarter-dot"></div>
<div class="quarter-dot"></div>
<div class="quarter-dot"></div>
</div>
</div>

<div id="statusBadge">EN VIVO</div>
</div>
</div>

<div class="content-box">
<h3>Crónica del partido</h3>
<ul id="timelineList"></ul>
</div>

</div>

<!-- STATS -->
<div id="viewStats" style="display:none">
<div id="stats_container" class="content-box">

<div id="qbTitle">Estadísticas QB</div>
<div id="qbName">Nombre: —</div>
<div id="qbPct">CMP/ATT: 0/0</div>

<div>Yds Pase: <span id="qbPassYds">0</span></div>
<div>TD Pase: <span id="qbPassTd">0</span></div>
<div>INTs: <span id="qbInts">0</span></div>
<div>Yds Tierra: <span id="qbRushYds">0</span></div>
<div>TD Tierra: <span id="qbRushTd">0</span></div>

</div>
</div>

<!-- HISTORY -->
<div id="viewHistory" style="display:none">
<div class="content-box">

<select id="history_select"></select>
<button onclick="loadHistoryToViewer()">Ver partido</button>
<button onclick="backToLive()">Volver en vivo</button>

<div id="history_hint"></div>

</div>
</div>

</div>

<script>

const refGame=db.ref("game");
const refTeams=db.ref("teams");
const refHistory=db.ref("history");

const teamData={};

refTeams.on("value",snap=>{
const t=snap.val()||{};
for(const k in t){
teamData[k]=t[k];
}
});

function showTab(t){
viewScore.style.display=t==="score"?"block":"none";
viewStats.style.display=t==="stats"?"block":"none";
viewHistory.style.display=t==="history"?"block":"none";

tabScore.classList.toggle("active",t==="score");
tabStats.classList.toggle("active",t==="stats");
tabHistory.classList.toggle("active",t==="history");
}

function getInitials(n){
if(!n)return "?";
return n.split(" ").map(w=>w[0]).join("").substring(0,2).toUpperCase();
}

function paint(side,name,score){

const isHome=side==="home";
const panel=document.getElementById(isHome?"homePanel":"awayPanel");
const logo=document.getElementById(isHome?"homeLogo":"awayLogo");

panel.style.setProperty("--team-color",teamData[name]?.color||"#333");

document.getElementById(isHome?"homeName":"awayName").textContent=name||"—";
document.getElementById(isHome?"homeScore":"awayScore").textContent=score??0;

logo.innerHTML=`<span>${getInitials(name)}</span>`;
}

function renderQB(qb){

const title=qbTitle;
const name=qbName;
const pct=qbPct;

if(!qb){
title.textContent="Estadísticas QB";
name.textContent="Nombre: —";
pct.textContent="CMP/ATT 0/0";
return;
}

const st=qb.stats||{};
const cmp=st.pass_cmp||0;
const att=st.pass_att||0;
const p=att?((cmp/att)*100).toFixed(1):0;

title.textContent="QB "+qb.team;
name.textContent="Nombre: "+qb.name;
pct.textContent=`CMP/ATT ${cmp}/${att} (${p}%)`;

qbPassYds.textContent=st.pass_yds||0;
qbPassTd.textContent=st.pass_td||0;
qbInts.textContent=st.ints||0;
qbRushYds.textContent=st.rush_yds||0;
qbRushTd.textContent=st.rush_td||0;

}

function renderTimeline(data){
timelineList.innerHTML="";
const tl=data.timeline||[];

[...tl].reverse().forEach(x=>{
const li=document.createElement("li");
li.textContent=x;
timelineList.appendChild(li);
});
}

refGame.on("value",snap=>{

const d=snap.val()||{};

metaLine.textContent=(d.location||"")+" "+(d.date||"");

paint("home",d.team_home,d.score_home);
paint("away",d.team_away,d.score_away);

quarterText.textContent=d.finished?"FINAL":d.quarter||"1Q";

renderTimeline(d);

const qb=d.players?.qb||null;
renderQB(qb);

});

refHistory.on("value",snap=>{
const data=snap.val()||{};
history_select.innerHTML="";

Object.keys(data).sort((a,b)=>b-a).forEach(k=>{
const g=data[k];
history_select.innerHTML+=`<option value="${k}">
${g.team_home} ${g.score_home}-${g.score_away} ${g.team_away}
</option>`;
});
});

function loadHistoryToViewer(){

const k=history_select.value;
if(!k)return;

refHistory.child(k).once("value").then(s=>{
const d=s.val();

paint("home",d.team_home,d.score_home);
paint("away",d.team_away,d.score_away);

renderTimeline(d);

});
}

function backToLive(){
showTab("score");
}

</script>

</body>
</html>
